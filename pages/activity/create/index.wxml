<!-- pages/activity/create/index.wxml -->
<view class="container">
  <view class="form-group">
    <form bindsubmit="submitForm">
      <!-- æ´»åŠ¨æ ‡é¢˜ -->
      <view class="form-item">
        <view class="form-label">æ´»åŠ¨æ ‡é¢˜</view>
        <input 
          class="form-input" 
          name="title" 
          placeholder="è¯·è¾“å…¥æ´»åŠ¨æ ‡é¢˜ï¼ˆä¸è¶…è¿‡30å­—ï¼‰" 
          maxlength="30" 
          value="{{formData.title}}"
          bindinput="onTitleInput"
        />
        <view class="form-tip" wx:if="{{errors.title}}">{{errors.title}}</view>
      </view>

      <!-- æ´»åŠ¨ç±»å‹ -->
      <view class="form-item">
        <view class="form-label">æ´»åŠ¨ç±»å‹</view>
        <picker 
          mode="selector" 
          range="{{activityTypes}}" 
          value="{{typeIndex}}" 
          bindchange="onTypeChange"
          name="type"
        >
          <view class="form-picker {{formData.type ? '' : 'placeholder'}}">
            {{formData.type || 'è¯·é€‰æ‹©æ´»åŠ¨ç±»å‹'}}
            <text class="arrow">></text>
          </view>
        </picker>
        <view class="form-tip" wx:if="{{errors.type}}">{{errors.type}}</view>
      </view>

      <!-- æ´»åŠ¨åœ°ç‚¹ -->
      <view class="form-item">
        <view class="form-label">æ´»åŠ¨åœ°ç‚¹</view>
        <view class="location-picker" bindtap="chooseLocation">
          <view class="{{formData.address ? 'location-text' : 'location-placeholder'}}">
            {{formData.address || 'ç‚¹å‡»é€‰æ‹©æ´»åŠ¨åœ°ç‚¹'}}
          </view>
          <text class="icon-location">ğŸ“</text>
        </view>
        <view class="form-tip" wx:if="{{errors.address}}">{{errors.address}}</view>
      </view>

      <!-- æ´»åŠ¨æ—¶é—´ -->
      <view class="form-item">
        <view class="form-label">æ´»åŠ¨å¼€å§‹æ—¶é—´</view>
        <view class="time-picker-trigger" bindtap="showStartTimePicker">
          <view class="{{formData.startTime ? 'time-text' : 'time-placeholder'}}">
            {{formData.startTime || 'è¯·é€‰æ‹©æ´»åŠ¨å¼€å§‹æ—¶é—´'}}
          </view>
          <text class="icon-calendar">ğŸ“…</text>
        </view>
        <view class="form-tip" wx:if="{{errors.startTime}}">{{errors.startTime}}</view>
      </view>

      <view class="form-item">
        <view class="form-label">æ´»åŠ¨ç»“æŸæ—¶é—´</view>
        <view class="time-picker-trigger" bindtap="showEndTimePicker">
          <view class="{{formData.endTime ? 'time-text' : 'time-placeholder'}}">
            {{formData.endTime || 'è¯·é€‰æ‹©æ´»åŠ¨ç»“æŸæ—¶é—´'}}
          </view>
          <text class="icon-calendar">ğŸ“…</text>
        </view>
        <view class="form-tip" wx:if="{{errors.endTime}}">{{errors.endTime}}</view>
      </view>

      <!-- äººæ•°é™åˆ¶ -->
      <view class="form-item">
        <view class="form-label">äººæ•°é™åˆ¶</view>
        <input 
          class="form-input" 
          name="maxParticipants" 
          type="number" 
          placeholder="è¯·è¾“å…¥äººæ•°é™åˆ¶ï¼ˆä¸å¡«åˆ™ä¸é™åˆ¶ï¼‰" 
          value="{{formData.maxParticipants}}"
          bindinput="onMaxParticipantsInput"
        />
        <view class="form-tip" wx:if="{{errors.maxParticipants}}">{{errors.maxParticipants}}</view>
      </view>

      <!-- æŠ¥åæˆªæ­¢æ—¶é—´ -->
      <view class="form-item">
        <view class="form-label">æŠ¥åæˆªæ­¢æ—¶é—´</view>
        <view class="time-picker-trigger" bindtap="showRegistrationDeadlinePicker">
          <view class="{{formData.registrationDeadline ? 'time-text' : 'time-placeholder'}}">
            {{formData.registrationDeadline || 'è¯·é€‰æ‹©æŠ¥åæˆªæ­¢æ—¶é—´'}}
          </view>
          <text class="icon-calendar">ğŸ“…</text>
        </view>
        <view class="form-tip" wx:if="{{errors.registrationDeadline}}">{{errors.registrationDeadline}}</view>
      </view>

      <!-- æ´»åŠ¨è¯¦æƒ… -->
      <view class="form-item">
        <view class="form-label">æ´»åŠ¨è¯¦æƒ…</view>
        <textarea 
          class="form-textarea" 
          name="description" 
          placeholder="è¯·è¾“å…¥æ´»åŠ¨è¯¦æƒ…ï¼Œå¦‚æ´»åŠ¨æµç¨‹ã€æ³¨æ„äº‹é¡¹ç­‰ï¼ˆä¸è¶…è¿‡500å­—ï¼‰" 
          maxlength="500" 
          value="{{formData.description}}"
          bindinput="onDescriptionInput"
        ></textarea>
        <view class="textarea-counter">{{descriptionLength}}/500</view>
        <view class="form-tip" wx:if="{{errors.description}}">{{errors.description}}</view>
      </view>

      <!-- ä¸Šä¼ æ´»åŠ¨å°é¢ -->
      <view class="form-item">
        <view class="form-label">æ´»åŠ¨å°é¢</view>
        <view class="upload-container">
          <view class="upload-preview" wx:if="{{formData.coverImage}}">
            <image src="{{formData.coverImage}}" mode="aspectFill"></image>
            <view class="upload-delete" bindtap="deleteCoverImage">Ã—</view>
          </view>
          <view class="upload-button" bindtap="uploadCoverImage" wx:else>
            <text class="upload-icon">+</text>
            <view>ä¸Šä¼ å°é¢</view>
          </view>
        </view>
        <view class="form-tip" wx:if="{{errors.coverImage}}">{{errors.coverImage}}</view>
      </view>

      <!-- æäº¤æŒ‰é’® -->
      <view class="form-submit">
        <button class="submit-button" form-type="submit">åˆ›å»ºæ´»åŠ¨</button>
      </view>
    </form>
  </view>
</view>

<!-- æ—¶é—´é€‰æ‹©å™¨ç»„ä»¶ -->
<time-picker
  visible="{{startTimePickerVisible}}"
  title="é€‰æ‹©æ´»åŠ¨å¼€å§‹æ—¶é—´"
  bind:confirm="onStartTimeConfirm"
  bind:cancel="onTimePickerCancel"
  bind:close="onTimePickerClose"
  minDate="{{minDate}}"
  showDate="{{true}}"
  showTime="{{true}}"
></time-picker>

<time-picker
  visible="{{endTimePickerVisible}}"
  title="é€‰æ‹©æ´»åŠ¨ç»“æŸæ—¶é—´"
  bind:confirm="onEndTimeConfirm"
  bind:cancel="onTimePickerCancel"
  bind:close="onTimePickerClose"
  minDate="{{minDate}}"
  showDate="{{true}}"
  showTime="{{true}}"
></time-picker>

<time-picker
  visible="{{registrationDeadlinePickerVisible}}"
  title="é€‰æ‹©æŠ¥åæˆªæ­¢æ—¶é—´"
  bind:confirm="onRegistrationDeadlineConfirm"
  bind:cancel="onTimePickerCancel"
  bind:close="onTimePickerClose"
  minDate="{{minDate}}"
  maxDate="{{maxRegistrationDate}}"
  showDate="{{true}}"
  showTime="{{true}}"
></time-picker>

<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<view class="custom-nav" style="height: {{navBarHeight}}px;">
  <view class="nav-content" style="top: {{statusBarHeight}}px;">
    <view class="nav-back" bindtap="navigateBack">
      <view class="back-icon">â†</view>
    </view>
    <view class="nav-title">åˆ›å»ºæ´»åŠ¨</view>
  </view>
</view>