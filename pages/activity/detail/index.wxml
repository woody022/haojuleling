<!-- pages/activity/detail/index.wxml -->
<view class="container">
  <!-- æ´»åŠ¨å°é¢ -->
  <view class="cover-wrapper">
    <image class="cover-image" src="{{activityDetail.coverImage}}" mode="aspectFill"></image>
    <view class="activity-status {{activityDetail.statusClass}}">{{activityDetail.statusText}}</view>
  </view>
  
  <!-- æ´»åŠ¨æ ‡é¢˜ä¿¡æ¯ -->
  <view class="activity-info-card">
    <view class="activity-title">{{activityDetail.title}}</view>
    <view class="activity-type">{{activityDetail.type}}</view>
    
    <!-- æ—¶é—´ä¿¡æ¯ -->
    <view class="info-item">
      <view class="info-icon time-icon">â±</view>
      <view class="info-content">
        <view class="info-label">æ´»åŠ¨æ—¶é—´</view>
        <view class="info-text">{{activityDetail.startTime}} ~ {{activityDetail.endTime}}</view>
      </view>
    </view>
    
    <!-- åœ°ç‚¹ä¿¡æ¯ -->
    <view class="info-item" bindtap="openLocation">
      <view class="info-icon location-icon">ğŸ“</view>
      <view class="info-content">
        <view class="info-label">æ´»åŠ¨åœ°ç‚¹</view>
        <view class="info-text">{{activityDetail.address}}</view>
      </view>
      <view class="info-action">å¯¼èˆª</view>
    </view>
    
    <!-- æŠ¥åæˆªæ­¢æ—¶é—´ -->
    <view class="info-item">
      <view class="info-icon deadline-icon">ğŸ“…</view>
      <view class="info-content">
        <view class="info-label">æŠ¥åæˆªæ­¢</view>
        <view class="info-text">{{activityDetail.registrationDeadline}}</view>
      </view>
    </view>
    
    <!-- å‚ä¸äººæ•° -->
    <view class="info-item">
      <view class="info-icon people-icon">ğŸ‘¥</view>
      <view class="info-content">
        <view class="info-label">æŠ¥åäººæ•°</view>
        <view class="info-text">{{activityDetail.participantsCount}}{{activityDetail.maxParticipants ? '/' + activityDetail.maxParticipants : ''}}</view>
      </view>
    </view>
  </view>
  
  <!-- ç»„ç»‡è€…ä¿¡æ¯ -->
  <view class="organizer-card">
    <view class="card-title">ç»„ç»‡è€…</view>
    <view class="organizer-info">
      <image class="organizer-avatar" src="{{activityDetail.organizer.avatar}}"></image>
      <view class="organizer-content">
        <view class="organizer-name">{{activityDetail.organizer.name}}</view>
        <view class="organizer-desc">{{activityDetail.organizer.description}}</view>
      </view>
      <button class="contact-btn" open-type="contact" wx:if="{{activityDetail.organizer.enableContact}}">è”ç³»</button>
    </view>
  </view>
  
  <!-- æ´»åŠ¨è¯¦æƒ… -->
  <view class="detail-card">
    <view class="card-title">æ´»åŠ¨è¯¦æƒ…</view>
    <view class="detail-content">
      <text>{{activityDetail.description}}</text>
    </view>
    <view class="image-list" wx:if="{{activityDetail.imageList && activityDetail.imageList.length > 0}}">
      <image 
        wx:for="{{activityDetail.imageList}}" 
        wx:key="index" 
        src="{{item}}" 
        mode="aspectFill" 
        class="detail-image"
        data-index="{{index}}"
        bindtap="previewImage"
      ></image>
    </view>
  </view>
  
  <!-- å‚ä¸è€…åˆ—è¡¨ -->
  <view class="participants-card" wx:if="{{activityDetail.participants && activityDetail.participants.length > 0}}">
    <view class="card-title">å‚ä¸è€… ({{activityDetail.participantsCount}})</view>
    <view class="participants-list">
      <view 
        class="participant-item" 
        wx:for="{{activityDetail.participants}}" 
        wx:key="id"
      >
        <image class="participant-avatar" src="{{item.avatar}}"></image>
        <text class="participant-name">{{item.name}}</text>
      </view>
      <view class="participant-more" wx:if="{{activityDetail.participantsCount > 8}}" bindtap="showAllParticipants">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
      </view>
    </view>
  </view>
  
  <!-- æ´»åŠ¨è¯„è®º -->
  <view class="comments-card">
    <view class="card-title">è¯„è®º ({{comments.length}})</view>
    <view class="comments-list">
      <block wx:if="{{comments.length > 0}}">
        <view class="comment-item" wx:for="{{comments}}" wx:key="id">
          <comment-item comment="{{item}}" bind:reply="replyComment" />
        </view>
      </block>
      <view class="no-comment" wx:else>
        <text>æš‚æ— è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§</text>
      </view>
    </view>
    
    <view class="comment-input-area" wx:if="{{isLogin}}">
      <input 
        class="comment-input" 
        placeholder="{{replyTo ? 'å›å¤ ' + replyTo : 'è¯´ç‚¹ä»€ä¹ˆ...'}}" 
        value="{{commentContent}}"
        bindinput="onCommentInput"
        focus="{{commentFocus}}"
      />
      <button class="comment-submit" bindtap="submitComment" disabled="{{!commentContent}}">å‘é€</button>
    </view>
    <view class="login-tip" wx:else>
      <text>è¯·å…ˆ</text>
      <text class="login-btn" bindtap="goLogin">ç™»å½•</text>
      <text>åå†è¯„è®º</text>
    </view>
  </view>
  
  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="action-bar">
    <view class="action-left">
      <view class="action-item" bindtap="toggleFavorite">
        <view class="action-icon {{isFavorite ? 'favorite-active' : ''}}">â¤</view>
        <view class="action-text">{{isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}</view>
      </view>
      <view class="action-item" bindtap="showShareOptions">
        <view class="action-icon">â†—</view>
        <view class="action-text">åˆ†äº«</view>
      </view>
      <button class="action-item action-contact" open-type="contact">
        <view class="action-icon">ğŸ’¬</view>
        <view class="action-text">å®¢æœ</view>
      </button>
    </view>
    <view class="action-right">
      <button 
        class="signup-btn {{isSignedUp ? 'signed-up' : ''}} {{isSignupDisabled ? 'disabled' : ''}}" 
        bindtap="toggleSignup"
        disabled="{{isSignupDisabled}}"
      >
        {{signupBtnText}}
      </button>
    </view>
  </view>
  
  <!-- æŠ¥åæˆåŠŸå¼¹çª— -->
  <view class="modal {{showSignupSuccess ? 'show' : ''}}" bindtap="hideModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-icon success-icon">âœ“</view>
      <view class="modal-title">æŠ¥åæˆåŠŸ</view>
      <view class="modal-message">æ‚¨å·²æˆåŠŸæŠ¥åå‚åŠ è¯¥æ´»åŠ¨</view>
      <view class="modal-tip">æ´»åŠ¨å¼€å§‹å‰å°†é€šè¿‡å¾®ä¿¡é€šçŸ¥æ‚¨</view>
      <button class="modal-btn" bindtap="hideModal">æˆ‘çŸ¥é“äº†</button>
    </view>
  </view>
  
  <!-- å–æ¶ˆæŠ¥åå¼¹çª— -->
  <view class="modal {{showCancelSignup ? 'show' : ''}}" bindtap="hideModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-title">ç¡®è®¤å–æ¶ˆæŠ¥å?</view>
      <view class="modal-message">å–æ¶ˆæŠ¥ååï¼Œæ‚¨çš„åé¢å°†è¢«é‡Šæ”¾</view>
      <view class="modal-buttons">
        <button class="modal-btn cancel-btn" bindtap="hideModal">å†æƒ³æƒ³</button>
        <button class="modal-btn confirm-btn" bindtap="confirmCancelSignup">ç¡®è®¤å–æ¶ˆ</button>
      </view>
    </view>
  </view>
  
  <!-- åˆ†äº«é€‰é¡¹å¼¹çª— -->
  <view class="share-modal {{showShare ? 'show' : ''}}" bindtap="hideShareModal">
    <view class="share-content" catchtap="stopPropagation">
      <view class="share-title">åˆ†äº«è‡³</view>
      <view class="share-options">
        <button class="share-item" open-type="share">
          <view class="share-icon wechat-icon">å¾®ä¿¡</view>
          <view class="share-text">å¾®ä¿¡å¥½å‹</view>
        </button>
        <view class="share-item" bindtap="shareToMoments">
          <view class="share-icon moments-icon">æœ‹å‹åœˆ</view>
          <view class="share-text">ç”Ÿæˆæµ·æŠ¥</view>
        </view>
        <view class="share-item" bindtap="copyLink">
          <view class="share-icon link-icon">é“¾æ¥</view>
          <view class="share-text">å¤åˆ¶é“¾æ¥</view>
        </view>
      </view>
      <button class="share-cancel" bindtap="hideShareModal">å–æ¶ˆ</button>
    </view>
  </view>
</view>